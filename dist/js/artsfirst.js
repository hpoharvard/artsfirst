require(["esri/Map","esri/views/MapView","esri/layers/FeatureLayer","esri/layers/MapImageLayer","esri/renderers/SimpleRenderer","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleFillSymbol","esri/renderers/UniqueValueRenderer","esri/widgets/Search","esri/widgets/Popup","esri/widgets/Legend","esri/geometry/Extent","esri/symbols/TextSymbol","dojo/query","bootstrap/Dropdown","bootstrap/Collapse","calcite-maps/calcitemaps-v0.3","dojo/domReady!"],function(e,r,o,t,l,s,n,a,c,u,p,m,d,y){new s({size:10,color:"#ffff00",style:"circle",outline:{width:2.4,color:[255,255,0,.4]}});var f=new s({size:10,color:"#99ff33",style:"circle",outline:{width:2.4,color:[153,255,51,.4]}}),w=new s({size:10,color:"#009900",style:"circle",outline:{width:2.4,color:[0,153,0,.4]}}),h=new s({size:10,color:"#0000ff",style:"circle",outline:{width:2.4,color:[0,0,255,.4]}}),b=(new s({size:10,color:"#cc66ff",style:"circle",outline:{width:2.4,color:[204,102,255,.4]}}),new s({size:10,color:"#990000",style:"circle",outline:{width:2.4,color:[153,0,0,.4]}})),g=(new s({size:10,color:"#ffb84d",style:"circle",outline:{width:2.4,color:[255,184,77,.4]}}),new s({size:10,color:"#e68a00",style:"circle",outline:{width:2.4,color:[230,138,0,.4]}})),v=new s({size:10,color:"#ff99ff",style:"circle",outline:{width:2.4,color:[255,153,255,.4]}}),z=new s({size:10,color:"#ff3300",style:"circle",outline:{width:2.4,color:[255,51,0,.4]}}),_=(new s({size:10,color:"#cccc00",style:"circle",outline:{width:2.4,color:[204,204,0,.4]}}),new o({url:"https://map.harvard.edu/arcgis/rest/services/artsfirst/artsfirst2018/MapServer/0",outFields:["*"],popupTemplate:{title:"{Primary_Category}",content:"<p>Address: <b>{Address_1}</b></p><p> Location: <b>{Venue_1}</b></p>"},visible:!0,renderer:new a({field:"Primary_Category",uniqueValueInfos:[{value:"Dance",symbol:f},{value:"Exhibitions",symbol:w},{value:"Films",symbol:h},{value:"Japanese Tea Ceremony",symbol:b},{value:"Make Art Stations",symbol:g},{value:"Music",symbol:v},{value:"Performance Fair",symbol:z},{value:"Public Art",symbol:new s({size:10,color:"#ffff00",style:"circle",outline:{width:2.4,color:[255,255,0,.4]}})},{value:"Theater",symbol:new s({size:10,color:"#663300",style:"circle",outline:{width:2.4,color:[102,51,0,.4]}})}]})})),P=new t({url:"https://map.harvard.edu/arcgis/rest/services/artsfirst/artsfirst2018/MapServer",sublayers:[{id:1,labelsVisible:!0,labelingInfo:[{labelExpression:"[name]",labelPlacement:"always-horizontal",symbol:new d({color:[0,0,0,.85],font:{size:14}})}]}]}),x=new r({container:"mapViewDiv",map:new e({basemap:"topo",layers:[_,P]}),center:[-71.116076,42.37375],zoom:16,padding:{top:50,bottom:0},breakpoints:{xsmall:768,small:769,medium:992,large:1200}});function M(){var e=_.createQuery();return _.queryFeatures(e).then(function(e){return console.log(e),function(e,r){1===e&&(x.center=[r[0].geometry.longitude,r[0].geometry.latitude],x.zoom=18);var o=[],t=[];for(i=0;i<e;i++)o.push(r[i].geometry.x),t.push(r[i].geometry.y);o.sort(),t.sort();var l=o[0],s=t[0],n=o[o.length-1],a=t[t.length-1];x.extent=new m({xmin:l,ymin:s,xmax:n,ymax:a,spatialReference:102100}),x.zoom=x.zoom-1}(e.features.length,e.features),artsGeometries=e.features.map(function(e){return e.geometry}),artsGeometries})}x.then(function(){return _.then(function(){var e=_.createQuery();return _.queryFeatures(e)})}).then(function(e){return e.features.map(function(e){return e.attributes.Primary_Category})}).then(function(e){var i=[];return e.forEach(function(e,r){(i.length<1||-1===i.indexOf(e))&&""!==e&&i.push(e)}),i});var S=new p({view:x,height:"200px",width:"200px",layerInfos:[{layer:_,title:"Arts Venue"}]});new c({view:x,allPlaceholder:"Building",sources:[{featureLayer:new o({url:"https://map.harvard.edu/arcgis/rest/services/HUMercator/MapServer/16",popupTemplate:{title:"{Primary_Building_Name}",overwriteActions:!0}}),searchFields:["Primary_Building_Name"],displayField:"Primary_Building_Name",exactMatch:!1,outFields:["Primary_Building_Name"],name:"",placeholder:"Building Name",resultSymbol:{type:"simple-fill",color:[255,255,255,.5],outline:{color:[36,133,255],width:2}}}]},"searchWidgetDiv").viewModel.on("select-result",function(e){x.zoom=18}),y("#selectFilterPanel").on("change",function(e){var r;!0===x.popup.visible&&x.popup.close(),r=e.target.value,_.definitionExpression="%"==r?"Primary_Category Like '"+r+"'":"Primary_Category = '"+r+"'",_.visible||(_.visible=!0),M()}),y("#toggleLegend").on("click",function(){null==document.getElementById("esri_widgets_Legend_0")?(x.ui.add(S,"bottom-left"),document.getElementsByClassName("esri-legend__layer-caption")[0].remove()):x.ui.remove(S,"bottom-left")}),x.watch("widthBreakpoint",function(e){x.popup.dockOptions.position="medium"===e||"large"===e||"xlarge"===e?"top-right":"bottom-center"}),x.popup.watch(["visible","currentDockPosition"],function(){x.popup.visible&&x.popup.currentDockPosition?y(".calcite-panels").addClass("invisible"):y(".calcite-panels").removeClass("invisible")}),y(".calcite-panels .panel").on("show.bs.collapse",function(e){x.popup.currentDockPosition&&(x.popup.dockEnabled=!1)})});