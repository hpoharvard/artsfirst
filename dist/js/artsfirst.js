require(["esri/Map","esri/views/MapView","esri/layers/FeatureLayer","esri/layers/MapImageLayer","esri/renderers/SimpleRenderer","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleFillSymbol","esri/renderers/UniqueValueRenderer","esri/widgets/Search","esri/widgets/Popup","esri/widgets/Legend","esri/geometry/Extent","esri/symbols/TextSymbol","dojo/query","bootstrap/Dropdown","bootstrap/Collapse","calcite-maps/calcitemaps-v0.3","dojo/domReady!"],function(e,r,o,t,l,s,n,a,c,u,m,p,d,y){function f(e){return"%"==e?(F.definitionExpression="Primary_Category Like '"+e+"'",F.visible||(F.visible=!0),w()):(F.definitionExpression="Primary_Category = '"+e+"'",F.visible||(F.visible=!0),w())}function w(){var e=F.createQuery();return F.queryFeatures(e).then(function(e){return console.log(b(e.features.length,e.features)),b(e.features.length,e.features),artsGeometries=e.features.map(function(e){return e.geometry}),artsGeometries})}function b(e,r){var o=[],t=[];for(i=0;i<e;i++)o.push(r[i].geometry.x),t.push(r[i].geometry.y);o.sort(),t.sort();var l=o[0],s=t[0],n=o[o.length-1],a=t[t.length-1];M.extent=new p({xmin:l,ymin:s,xmax:n,ymax:a,spatialReference:102100}),M.zoom>18&&(M.zoom=18)}var h={title:"{Primary_Category}",content:"<p>Address: <b>{Address_1}</b></p><p> Location: <b>{Venue_1}</b></p>"},v=new s({size:10,color:"#ffff00",style:"circle",outline:{width:2.4,color:[255,255,0,.4]}}),g=new s({size:10,color:"#99ff33",style:"circle",outline:{width:2.4,color:[153,255,51,.4]}}),_=new s({size:10,color:"#009900",style:"circle",outline:{width:2.4,color:[0,153,0,.4]}}),x=new s({size:10,color:"#0000ff",style:"circle",outline:{width:2.4,color:[0,0,255,.4]}}),P=new s({size:10,color:"#cc66ff",style:"circle",outline:{width:2.4,color:[204,102,255,.4]}}),z=new s({size:10,color:"#990000",style:"circle",outline:{width:2.4,color:[153,0,0,.4]}}),F=(new s({size:10,color:"#ffb84d",style:"circle",outline:{width:2.4,color:[255,184,77,.4]}}),new o({url:"https://map.harvard.edu/arcgis/rest/services/ArtsFirst/artsfirst17/MapServer/0",outFields:["*"],popupTemplate:h,visible:!0,renderer:new a({field:"Primary_Category",uniqueValueInfos:[{value:"Conference",symbol:v},{value:"Dance",symbol:g},{value:"Exhibitions",symbol:_},{value:"Films",symbol:x},{value:"Harvard Arts Medal Ceremony",symbol:P},{value:"Japanese Tea Ceremony",symbol:z},{value:"Make Art Stations",symbol:new s({size:10,color:"#e68a00",style:"circle",outline:{width:2.4,color:[230,138,0,.4]}})},{value:"Music",symbol:new s({size:10,color:"#ff99ff",style:"circle",outline:{width:2.4,color:[255,153,255,.4]}})},{value:"Performance Fair",symbol:new s({size:10,color:"#ff3300",style:"circle",outline:{width:2.4,color:[255,51,0,.4]}})},{value:"Pow Wow",symbol:new s({size:10,color:"#cccc00",style:"circle",outline:{width:2.4,color:[204,204,0,.4]}})},{value:"Public Art",symbol:new s({size:10,color:"#993399",style:"circle",outline:{width:2.4,color:[153,51,153,.4]}})},{value:"Theater",symbol:new s({size:10,color:"#663300",style:"circle",outline:{width:2.4,color:[102,51,0,.4]}})}]})})),C=new t({url:"https://map.harvard.edu/arcgis/rest/services/ArtsFirst/artsfirst17/MapServer",sublayers:[{id:1,labelsVisible:!0,labelingInfo:[{labelExpression:"[name]",labelPlacement:"always-horizontal",symbol:new d({color:[0,0,0,.85],font:{size:14}})}]}]}),M=new r({container:"mapViewDiv",map:new e({basemap:"topo",layers:[F,C]}),center:[-71.116076,42.37375],zoom:18,padding:{top:50,bottom:0},breakpoints:{xsmall:768,small:769,medium:992,large:1200}});M.then(function(){return F.then(function(){var e=F.createQuery();return F.queryFeatures(e)})}).then(function(e){return e.features.map(function(e){return e.attributes.Primary_Category})}).then(function(e){var r=[];return e.forEach(function(e,i){(r.length<1||-1===r.indexOf(e))&&""!==e&&r.push(e)}),r});var k=new m({view:M,height:"200px",width:"200px",layerInfos:[{layer:F,title:"Arts Venue"}]});new c({view:M,allPlaceholder:"Building",sources:[{featureLayer:new o({url:"https://map.harvard.edu/arcgis/rest/services/HUMercator/MapServer/16",popupTemplate:{title:"{Primary_Building_Name}",overwriteActions:!0}}),searchFields:["Primary_Building_Name"],displayField:"Primary_Building_Name",exactMatch:!1,outFields:["Primary_Building_Name"],name:"",placeholder:"Building Name"}]},"searchWidgetDiv");y("#selectFilterPanel").on("change",function(e){f(e.target.value),console.log(M.extent)}),y("#toggleLegend").on("click",function(){null==document.getElementById("esri_widgets_Legend_0")?(M.ui.add(k,"bottom-left"),document.getElementsByClassName("esri-legend__layer-caption")[0].remove()):M.ui.remove(k,"bottom-left")}),M.watch("widthBreakpoint",function(e){M.popup.dockOptions.position="medium"===e||"large"===e||"xlarge"===e?"top-right":"bottom-center"}),M.popup.watch(["visible","currentDockPosition"],function(){M.popup.visible&&M.popup.currentDockPosition?y(".calcite-panels").addClass("invisible"):y(".calcite-panels").removeClass("invisible")}),y(".calcite-panels .panel").on("show.bs.collapse",function(e){M.popup.currentDockPosition&&(M.popup.dockEnabled=!1)})});